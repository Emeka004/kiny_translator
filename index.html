<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸŒ Multilingual Translator App</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://kit.fontawesome.com/a2e8b7f2dd.js" crossorigin="anonymous"></script>
</head>
<body>
  <header>
    <h1>ğŸŒ Multilingual Translator App</h1>
    <button id="toggle-theme">ğŸŒ™ Dark Mode</button>
  </header>

  <main>
    <div class="translator-container">
      <div class="language-select">
        <label for="target-lang">Translate Into:</label>
        <select id="target-lang" aria-label="Select target language"></select>
      </div>

      <textarea
        id="input-text"
        rows="5"
        placeholder="Enter text in any language..."
        aria-label="Input text to translate"
      ></textarea>

      <button id="translate-btn" aria-label="Translate text">
        <i class="fas fa-language"></i> Translate
      </button>

      <div class="output" aria-live="polite" aria-atomic="true">
        <h3>Translation:</h3>
        <p id="translated-text">â€”</p>

        <div class="output-buttons">
          <button id="copy-btn" title="Copy translation" aria-label="Copy translation">
            <i class="fas fa-copy"></i>
          </button>
          <button id="speak-btn" title="Speak translation" aria-label="Speak translation">
            <i class="fas fa-volume-up"></i>
          </button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    Built with â¤ï¸ using
    <a href="https://libretranslate.com/" target="_blank" rel="noopener">LibreTranslate API</a>
  </footer>

  <script>
    const targetSelect = document.getElementById('target-lang');
    const translateBtn = document.getElementById('translate-btn');
    const inputText = document.getElementById('input-text');
    const translatedText = document.getElementById('translated-text');
    const copyBtn = document.getElementById('copy-btn');
    const speakBtn = document.getElementById('speak-btn');
    const toggleBtn = document.getElementById('toggle-theme');

    // Fetch supported languages dynamically
    async function fetchLanguages() {
      try {
        const response = await fetch('https://libretranslate.de/languages');
        if (!response.ok) throw new Error('Failed to fetch languages');
        const languages = await response.json();

        targetSelect.innerHTML = '';
        languages.forEach(lang => {
          const option = document.createElement('option');
          option.value = lang.code;
          option.textContent = lang.name;
          targetSelect.appendChild(option);
        });

        targetSelect.value = 'en'; // default to English
      } catch (err) {
        console.error(err);
        // fallback static list
        const fallback = [
          { code: 'en', name: 'English' },
          { code: 'rw', name: 'Kinyarwanda' },
          { code: 'fr', name: 'French' },
          { code: 'es', name: 'Spanish' },
        ];
        fallback.forEach(lang => {
          const option = document.createElement('option');
          option.value = lang.code;
          option.textContent = lang.name;
          targetSelect.appendChild(option);
        });
        targetSelect.value = 'en';
      }
    }

    // Translate text
    translateBtn.addEventListener('click', async () => {
      const text = inputText.value.trim();
      if (!text) {
        translatedText.textContent = 'Please enter text.';
        return;
      }

      translatedText.textContent = 'Detecting & Translatingâ€¦';

      try {
        const resp = await fetch('https://libretranslate.de/translate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            q: text,
            source: 'auto',
            target: targetSelect.value,
            format: 'text',
          }),
        });

        if (!resp.ok) throw new Error(`Error ${resp.status}`);

        const data = await resp.json();
        translatedText.textContent = data.translatedText || 'â€”';
      } catch (err) {
        console.error(err);
        translatedText.textContent = 'Translation failed.';
      }
    });

    // Copy translation to clipboard
    copyBtn.addEventListener('click', () => {
      const txt = translatedText.textContent;
      if (txt && txt !== 'â€”') {
        navigator.clipboard.writeText(txt);
        copyBtn.textContent = 'ğŸ“‹ Copied!';
        setTimeout(() => (copyBtn.innerHTML = '<i class="fas fa-copy"></i>'), 1200);
      }
    });

    // Speak translation using Web Speech API
    speakBtn.addEventListener('click', () => {
      const text = translatedText.textContent;
      if (!text || text === 'â€”') return;

      if (!window.speechSynthesis) {
        alert('Sorry, your browser does not support speech synthesis.');
        return;
      }

      // Try to match the voice language to the target language code if possible
      const targetLang = targetSelect.value;
      const utterance = new SpeechSynthesisUtterance(text);

      // Map some LibreTranslate codes to SpeechSynthesis language tags
      // This is a minimal mapping; extend as needed
      const langMap = {
        en: 'en-US',
        rw: 'rw-RW',
        fr: 'fr-FR',
        es: 'es-ES',
        de: 'de-DE',
        it: 'it-IT',
        pt: 'pt-PT',
        ru: 'ru-RU',
        ja: 'ja-JP',
        zh: 'zh-CN',
      };

      utterance.lang = langMap[targetLang] || targetLang;

      window.speechSynthesis.speak(utterance);
    });

    // Dark/light mode toggle
    toggleBtn.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      toggleBtn.textContent = isDark ? 'â˜€ Light Mode' : 'ğŸŒ™ Dark Mode';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    window.addEventListener('DOMContentLoaded', () => {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark') {
        document.body.classList.add('dark-mode');
        toggleBtn.textContent = 'â˜€ Light Mode';
      } else {
        toggleBtn.textContent = 'ğŸŒ™ Dark Mode';
      }
      fetchLanguages();
    });
  </script>
</body>
</html>


